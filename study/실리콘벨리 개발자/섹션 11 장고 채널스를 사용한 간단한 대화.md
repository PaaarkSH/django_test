# 섹션 11 장고 채널스를 사용한 간단한 대화방

# 장고 채널스에 대한 소개와 웹소켓

## 장고 채널스

- 하나의 프로젝트
- 웹소켓, http2, 다른 기타 프로토콜들을 다루기 위해 기능을 내장
- real time(실시간) 기능 제공
    - http 통신을 통한 request response 가 아닌 **웹 소켓**을 사용
- 웹소켓은 서버와 클라이언트 양방향의 커뮤니케이션 지원
- 실시간 업데이트 가능
- 채팅 어플리케이션 기능 가능

## 동기 VS 비동기

- 동기: 장고, 웹페이지
    - http request
    - 클라이언트가 리퀘스트를 전달 → 다음 일은 잠시 멈춰둠 → 서버가 응답을 받고 응답 메세지를 전송
        - 순차적
    - **클라이언트가 리퀘스트를 보내지 않는다면 서버는 메세지를 전송 할 수 없음**
        - 채널스가 서포트 가능
- 비동기: 장고 채널스(동기의 반대 의미라 a 가 붙음)
    - 동작
        - 클라이언트가 서버로 전송 → 서버가 다른 클라이언트한테 브로드 캐스트
        - 클라이언트도 자신이 보낸걸 볼수있어야되니 바로 서버한테 응답받음
        - 다른 클라이언트도 서버로 메세지를 전송하고 처음 클라이언트도 메세지를 전달받음
    - 커넥션을 유지 → 계속해서 업무를 수행
        - 같은 커넥션에서
    - 여러개의 업무를 한번에 수행 가능
    - 콜백 함수를 통해 전달하고, 전달 받으면 브라우저에서 콜백 함수를 실행하고 렌더링함

## 웹소켓

- 커뮤니케이션 프로토콜
    - http 프로토콜과 같이
- 하나의 커넥션에서, 오랫동안 살아있는 상태로 서버와 클라이언트의 커뮤니케이션 가능한 프로토콜

### 특징

- full-duplex communication : 클라이언트와 서버가 데이터를 각각 독립적으로 전달 가능
- persistant connection: 웹소켓을 한번 열어 놓으면 실시간으로 전송 가능
- 능률적: 하나의 웹 소켓 연결로 여러 데이터가 전송 가능
- 실시간 데이터 전송: 실시간 데이터 전송 가능

### 동작

- http request 전송
- 서버에서 클라이언트로 웹소켓을 사용한다고 전송
- 양방향 통신 시작
- 브라우저를 닫으면 커넥션 종료
    - 이러한 커넥션은 여러개 맻을 수 있음

## 장고 채널스

- 장고 채널스의 매커니즘
- 이런 웹소켓 서비스 제공
- http 통신도 웹소켓 통신도 가능

### http

- 보통 장고는 wsgi 를 통한 장고 views 를 호출함

### 웹소켓

- asgi 를 이용해서 views 와 같은 기능을 하는 Consumers 를 호출해 처리를 하고 유저한테 보내줌

## 장고 채널스의 컨셉

- 채널스: mail box 같은 역활
    - 여기에 다 메세지를 던짐
- consumer: 장고에서 뷰같은 역활
    - 메세지를 받을때 컨슈머가 작동을 하는 원리
- 라우팅: 컨슈머 함수에 대한 매핑
    - 장고도 라우팅이 있는데 그거랑 같음
- 채널 레이어: 여러개의 서버를 한꺼번에 연결할 수 있게 해주는 컴포넌트
    - 보통 레디스를 사용해서 구축

# 장고 채널즈 설치

# 기본적인 셋업

# 채팅 서버

# 비동기화로 채팅서버 업그레이드

# 셀레니엄을 사용해 자동화 테스트