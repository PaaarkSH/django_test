# μ„Ήμ… 9. Unittest

# Github Action μ„ μ‚¬μ©ν•΄ μ λ‹› ν…μ¤νΈ ν™κ²½ μ„¤μ •ν•κΈ°

# μ¥κ³  μ λ‹› ν…μ¤νΈ λ§λ“¤μ–΄λ³΄κΈ°

## Test Database

- migrations(optional)
    - λ¨λΈ λ³€κ²½ μ‚¬ν•­μ΄ μλ‹¤λ©΄ λ°μ
- run unnittest
    - μ λ‹›ν…μ¤νΈ μ‹¤ν–‰
- clear data
    - ν…μ¤νΈ μΆ…λ£ ν›„ db μ κ±°

## Test Classes

- μ¥κ³  μ¤ν”Όμ…λ΅ μ§€μ›ν•λ”κ² 4κ° μμ§€λ§ 2κ°λ” μ‚¬μ©ν•μ§€ μ•μΌλ‹ 2κ°λ§

### SimpleTestCase

- db μ—†μ΄ λ©”μ†λ“λ§ μ‚¬μ©ν• λ• μ‚¬μ©
- λΉ λ¦„

### TestCase

- λ°μ΄ν„° λ² μ΄μ¤μ™€ μ—°κ³„κ°€ λμ–΄μμ„κ²½μ° μ‚¬μ©
- μ™„λ£ ν›„μ— db clear
    - λ§¨ λ§μ§€λ§‰μ— λ™μ‘

<aside>
π’΅ κ°•μ λ‚΄μ©μ΄ api λ¥Ό ν†µν•κ² μ•„λ‹λ‹¤λ³΄λ‹ κ±°μ λ­ λ™μ‘ ν…μ¤νΈ μ •λ„λ§ μμ—μ

</aside>

# Mocking μ„ μ‚¬μ©ν• ν…μ¤νΈ κ·Έλ¦¬κ³  API end to end ν…μ¤νΈ λ°©λ²• μ•μ•„λ³΄κΈ°

## Mocking

- mocking: νΉμ • κΈ°λ¥μ΄λ‚ λ™μ‘μ„ κ°€μ§(mock) μΌλ΅ λ€μ²΄
- **μμ΅΄μ„±(action of dependencies)μ λ™μ‘ λ³€κ²½ λλ” μ—…λ°μ΄νΈ**
    - νΉμ • κΈ°λ¥μ΄λ‚ κ°μ²΄μ λ™μ‘μ„ λ³€κ²½ν•κ±°λ‚ μ—…λ°μ΄νΈν•΄μ•Ό ν•  λ•, ν•΄λ‹Ή λ™μ‘μ„ λ¨ν‚Ήν•μ—¬ ν•„μ”ν• λ€μ²΄ λ™μ‘μ„ μ κ³µν•  μ μμµλ‹λ‹¤
- **ν…μ¤νΈν•  μ½”λ“μ— μ§‘μ¤‘ν•κΈ° μ„ν• κ²©λ¦¬(isolate and focus on the code being tested)**
    - ν…μ¤νΈν•κ³ μ ν•λ” μ½”λ“κ°€ λ‹¤λ¥Έ μμ΅΄μ„±μ— μμ΅΄ν•λ” κ²½μ°, λ¨ν‚Ήμ„ μ‚¬μ©ν•μ—¬ ν•΄λ‹Ή μμ΅΄μ„±μ„ κ°€μ§λ΅ λ€μ²΄ν•μ—¬ ν…μ¤νΈ μ½”λ“κ°€ ν•΄λ‹Ή μμ΅΄μ„±μ— μν–¥μ„ λ°›μ§€ μ•λ„λ΅ ν•©λ‹λ‹¤.
- **μ™Έλ¶€ μ„λΉ„μ¤ μ‚¬μ©μ λ¶„λ¦¬(disconnect to use external services)**
    - μ™Έλ¶€ μ„λΉ„μ¤μ™€μ μ—°κ²°μ„ ν…μ¤νΈν•λ” κ²½μ°, μ‹¤μ  μ™Έλ¶€ μ„λΉ„μ¤λ¥Ό νΈμ¶ν•λ” λ€μ‹  λ¨ν‚Ήλ κ°μ²΄λ¥Ό μ‚¬μ©ν•μ—¬ μ™Έλ¶€ μ„λΉ„μ¤μ™€μ μ—°κ²°μ„ λ¶„λ¦¬ν•κ³  λ…λ¦½μ μΌλ΅ ν…μ¤νΈν•  μ μμµλ‹λ‹¤.
- **μμƒμΉ λ»ν• κ²°κ³Όμ λ°©μ§€**
    - μ‹¤μ λ΅ μ™Έλ¶€ μ„λΉ„μ¤λ¥Ό νΈμ¶ν•κ±°λ‚ λ‹¤λ¥Έ λ™μ‘μ„ μν–‰ν•λ” κ²½μ°, λ¨ν‚Ήμ„ μ‚¬μ©ν•μ—¬ μμƒμΉ λ»ν• κ²°κ³Όλ¥Ό λ°©μ§€ν•κ³  ν…μ¤νΈ μ½”λ“μ μ•μ •μ„±μ„ λ†’μΌ μ μμµλ‹λ‹¤.
        - μλ¥Ό λ“¤μ–΄, μ‹¤μ λ΅ Slack λ©”μ‹μ§€λ¥Ό λ³΄λ‚΄κ±°λ‚ μ 3μ APIλ¥Ό νΈμ¶ν•λ” λ€μ‹  λ¨ν‚Ήλ κ°μ²΄λ¥Ό μ‚¬μ©ν•μ—¬ ν•΄λ‹Ή λ™μ‘μ„ μ‹λ®¬λ μ΄μ…ν•  μ μμµλ‹λ‹¤.

### work flow

- μ¤λΈμ νΈ μƒμ„±
- db μ €μ¥
- μ¨λ“νν‹° μ΄λ²¤νΈ μ κ³µμ„ μ„ν• μ¨λ“νν‹° νΈμ¶
    - λ λ‹¤λ¥Έ μ΄λ²¤νΈμ— λ³΄λ‚Έλ‹¤λ” μλ―Έ
    - github hook μ΄λ‚ jenkins hook
    - ν…μ¤νΈλ¥Ό ν•λ©΄μ„ ν•΄λ‹Ή λ¶€λ¶„μ„ λ™μ‘ν•μ§€ μ•λ„λ΅ λ§‰μ•„ λ†“λ” μ—­ν™μ„ ν•κΈ° μ„ν•΄ λ§ν‚Ή

## unittest.mock

- `@patch`: ν…μ¤νΈλ¥Ό μ„ν• μ½”λ“λ¥Ό μ¬μ •μ ν• λ• μ‚¬μ©
    - μ²«λ²μ§Έ νλΌλ―Έν„°: μ–΄λ–¤ ν•¨μλ¥Ό λ§ν‚Ήν• κ±΄μ§€(κ°€μ§λ΅ κµ¬ν„ν•  λ€μƒ)
    - λ‘λ²μ§Έ νλΌλ―Έν„°: μ²«λ²μ§Έ νλΌλ―Έν„°μ ν•¨μλ¥Ό λ€μ²΄ν•  ν•¨μ

## API Client test

- μ¥κ³  drf μ—μ„ μ‚¬μ©
- TestClient μ„μ—μ„ λ™μ‘
- request λ¥Ό μƒμ„±ν•κ³  κ²°κ³Όλ¬Όμ„ ν™•μΈν• μμμ
    - μ΄κ² end to end
- κ¶ν• μ¬μ •μ κ°€λ¥

## TestCase λ™μ‘κ³Όμ •

- μ–΄λ–»κ² μ΄κ±°λ” main μ‹¤ν–‰ ν•¨μλ„ μ—†λ”λ° μ‹¤ν–‰μ΄ λ κΉ?
- ν…μ¤νΈ λ¬λ„λ” ν•΄λ‹Ή ν΄λμ¤μ— μƒμ„±λ ν…μ¤νΈν•¨μλ“¤μ„ λλ ¤λ³΄κ³  μ‹¤ν–‰ν•¨

## API Client λ” Mocking μΈκ°€?

- end to end ν…μ¤νΈκ°€ κ°€λ¥ν• APIClient μ¤λΈμ νΈλ” μ–΄λ–»κ² request λ¥Ό μ‹¤ν–‰ν• κΉ
- μ¥κ³ μ ν…μ¤νΈ ν”„λ μ„μ›ν¬κ°€ APIClient μ api λ¥Ό μ‹¤ν–‰μ‹μΌμ„ κ²°κ³Όλ¥Ό κ°€μ Έμ΄
- ν…μ¤νΈ ν”„λ μ„μ›ν¬λ” μ‹¤μ  μ‹¤ν–‰μ¤‘μΈ κΈ°μ΅΄ μ¥κ³  μ„λΉ„μ¤μ— μν–¥μ„ μ£Όμ§€ μ•μ
- μ‹¤μ  HTTP ν†µμ‹ μ„ ν†µν• μ„λ²„ νΈμ¶μ΄ μ•„λ‹κΈ° λ•λ¬Έμ— Mock μ΄λΌκ³  λ³Ό μ μμ