# 섹션 9. Unittest

# Github Action 을 사용해 유닛 테스트 환경 설정하기

# 장고 유닛 테스트 만들어보기

## Test Database

- migrations(optional)
    - 모델 변경 사항이 있다면 반영
- run unnittest
    - 유닛테스트 실행
- clear data
    - 테스트 종료 후 db 제거

## Test Classes

- 장고 오피셜로 지원하는게 4개 있지만 2개는 사용하지 않으니 2개만

### SimpleTestCase

- db 없이 메소드만 사용할때 사용
- 빠름

### TestCase

- 데이터 베이스와 연계가 되어있을경우 사용
- 완료 후에 db clear
    - 맨 마지막에 동작

<aside>
💡 강의 내용이 api 를 통한게 아니다보니 거의 뭐 동작 테스트 정도만 있었음

</aside>

# Mocking 을 사용한 테스트 그리고 API end to end 테스트 방법 알아보기

## Mocking

- mocking: 특정 기능이나 동작을 가짜(mock) 으로 대체
- **의존성(action of dependencies)의 동작 변경 또는 업데이트**
    - 특정 기능이나 객체의 동작을 변경하거나 업데이트해야 할 때, 해당 동작을 모킹하여 필요한 대체 동작을 제공할 수 있습니다
- **테스트할 코드에 집중하기 위한 격리(isolate and focus on the code being tested)**
    - 테스트하고자 하는 코드가 다른 의존성에 의존하는 경우, 모킹을 사용하여 해당 의존성을 가짜로 대체하여 테스트 코드가 해당 의존성에 영향을 받지 않도록 합니다.
- **외부 서비스 사용의 분리(disconnect to use external services)**
    - 외부 서비스와의 연결을 테스트하는 경우, 실제 외부 서비스를 호출하는 대신 모킹된 객체를 사용하여 외부 서비스와의 연결을 분리하고 독립적으로 테스트할 수 있습니다.
- **예상치 못한 결과의 방지**
    - 실제로 외부 서비스를 호출하거나 다른 동작을 수행하는 경우, 모킹을 사용하여 예상치 못한 결과를 방지하고 테스트 코드의 안정성을 높일 수 있습니다.
        - 예를 들어, 실제로 Slack 메시지를 보내거나 제3자 API를 호출하는 대신 모킹된 객체를 사용하여 해당 동작을 시뮬레이션할 수 있습니다.

### work flow

- 오브젝트 생성
- db 저장
- 써드파티 이벤트 제공을 위한 써드파티 호출
    - 또 다른 이벤트에 보낸다는 의미
    - github hook 이나 jenkins hook
    - 테스트를 하면서 해당 부분을 동작하지 않도록 막아 놓는 역활을 하기 위해 마킹

## unittest.mock

- `@patch`: 테스트를 위한 코드를 재정의 할때 사용
    - 첫번째 파라미터: 어떤 함수를 마킹할건지(가짜로 구현할 대상)
    - 두번째 파라미터: 첫번째 파라미터의 함수를 대체할 함수

## API Client test

- 장고 drf 에서 사용
- TestClient 위에서 동작
- request 를 생성하고 결과물을 확인할수있음
    - 이게 end to end
- 권한 재정의 가능

## TestCase 동작과정

- 어떻게 이거는 main 실행 함수도 없는데 실행이 될까?
- 테스트 러너는 해당 클래스에 생성된 테스트함수들을 돌려보고 실행함

## API Client 는 Mocking 인가?

- end to end 테스트가 가능한 APIClient 오브젝트는 어떻게 request 를 실행할까
- 장고의 테스트 프레임워크가 APIClient 의 api 를 실행시켜서 결과를 가져옴
- 테스트 프레임워크는 실제 실행중인 기존 장고 서비스에 영향을 주지 않음
- 실제 HTTP 통신을 통한 서버 호출이 아니기 때문에 Mock 이라고 볼 수 있음